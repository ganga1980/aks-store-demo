apiVersion: v1
kind: ServiceAccount
metadata:
  name: customer-agent-sa
  namespace: pets
  annotations:
    # Azure Workload Identity annotation
    # Replace with your actual Azure AD application client ID
    azure.workload.identity/client-id: "5b26b93a-8b7d-40c7-b8aa-ede25c78e9e6"
  labels:
    app: customer-agent
    azure.workload.identity/use: "true"
    app.kubernetes.io/name: customer-agent
    app.kubernetes.io/component: serviceaccount
    app.kubernetes.io/part-of: aks-store-demo
---
# Federated identity credential is configured in Azure AD
# This enables the Kubernetes ServiceAccount to authenticate to Azure services
# using Workload Identity without storing secrets
#
# To configure federated identity:
# az identity federated-credential create \
#   --name customer-agent-federated-credential \
#   --identity-name <managed-identity-name> \
#   --resource-group <resource-group> \
#   --issuer <aks-oidc-issuer-url> \
#   --subject system:serviceaccount:pets:customer-agent-sa \
#   --audience api://AzureADTokenExchange
